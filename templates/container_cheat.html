{% extends "admin/base.html" %}

{% block content %}
<div class="jumbotron">
	<div class="container">
		<h1>Anti-Cheat Logs</h1>
	</div>
</div>
<div class="container-fluid">
	<ul class="nav nav-tabs mb-3">
		<li class="nav-item">
			<a class="nav-link" href="{{ url_for('containers_admin.dashboard') }}">Instances</a>
		</li>
		<li class="nav-item">
			<a class="nav-link" href="{{ url_for('containers_admin.settings') }}">Settings</a>
		</li>
		<li class="nav-item">
			<a class="nav-link active" href="{{ url_for('containers_admin.cheats') }}">Anti-Cheat Logs</a>
		</li>
	</ul>

	{% if cheat_logs and cheat_logs|length > 0 %}
	<div class="alert alert-warning">
		<strong>Warning:</strong> {{ cheat_logs|length }} flag sharing attempt(s) detected
	</div>

	<table class="table table-striped border">
		<thead>
			<tr>
				<th class="text-center"><b>Time</b></th>
				<th class="text-center"><b>Challenge</b></th>
				<th class="text-center"><b>Flag Hash</b></th>
				<th class="text-center"><b>Original Owner</b></th>
				<th class="text-center"><b>Second Submitter</b></th>
			</tr>
		</thead>
		<tbody>
			{% for log in cheat_logs %}
			<tr>
				<td class="text-center">
					{{ log.timestamp.strftime('%Y-%m-%d %H:%M:%S') if log.timestamp else 'N/A' }}
				</td>
				<td class="text-center">
					<a href="{{ url_for('admin.challenges_detail', challenge_id=log.challenge_id) }}">
						{{ log.challenge.name if log.challenge else 'Challenge #' ~ log.challenge_id }}
					</a>
				</td>
				<td class="text-center">
					<code>{{ log.submitted_flag_hash[:20] }}...</code>
				</td>
				<td class="text-center">
					{% if log.owner_team %}
						<a href="{{ url_for('admin.teams_detail', team_id=log.owner_team.id) }}">
							<i class="fas fa-users"></i> {{ log.owner_team.name }}
						</a>
					{% elif log.owner_user_obj %}
						<a href="{{ url_for('admin.users_detail', user_id=log.owner_user_obj.id) }}">
							<i class="fas fa-user"></i> {{ log.owner_user_obj.name }}
						</a>
					{% else %}
						Account #{{ log.flag_owner_account_id if log.flag_owner_account_id else 'N/A' }}
					{% endif %}
				</td>
				<td class="text-center">
					{% if log.submitter_team %}
						<a href="{{ url_for('admin.teams_detail', team_id=log.submitter_team.id) }}">
							<i class="fas fa-users"></i> {{ log.submitter_team.name }}
						</a>
					{% elif log.submitter_user_obj %}
						<a href="{{ url_for('admin.users_detail', user_id=log.submitter_user_obj.id) }}">
							<i class="fas fa-user"></i> {{ log.submitter_user_obj.name }}
						</a>
					{% else %}
						Account #{{ log.account_id }}
					{% endif %}
				</td>
			</tr>
			{% endfor %}
		</tbody>
	</table>
	{% else %}
	<div class="alert alert-success">
		<i class="fas fa-check-circle"></i> No cheating events detected. All submissions are legitimate.
	</div>
	{% endif %}
</div>
{% endblock %}

{% block scripts %}
<script>
// Auto-refresh every 30 seconds
setInterval(() => {
	location.reload();
}, 30000);
</script>
{% endblock %}
