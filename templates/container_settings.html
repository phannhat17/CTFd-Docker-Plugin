{% extends "admin/base.html" %}

{% block content %}
<div class="jumbotron">
	<div class="container">
		<h1>Container Settings</h1>
	</div>
</div>
<div class="container-fluid">
	<ul class="nav nav-tabs mb-3">
		<li class="nav-item">
			<a class="nav-link" href="{{ url_for('containers_admin.dashboard') }}">Instances</a>
		</li>
		<li class="nav-item">
			<a class="nav-link active" href="{{ url_for('containers_admin.settings') }}">Settings</a>
		</li>
		<li class="nav-item">
			<a class="nav-link" href="{{ url_for('containers_admin.cheats') }}">Anti-Cheat Logs</a>
		</li>
	</ul>

	<form id="settings-form">
		<div class="card">
			<div class="card-header">
				<h5>Docker Configuration</h5>
			</div>
			<div class="card-body">
				<div class="form-group">
					<label for="docker_base_url">Docker Socket URL</label>
					<input class="form-control" type="text" name="docker_socket" id="docker_base_url"
						placeholder="unix://var/run/docker.sock or ssh://root@example.com"
						value="{{ settings.docker_base_url }}">
					<small class="form-text text-muted">
						The local socket address or remote SSH address for Docker daemon
					</small>
				</div>

				<div class="form-group">
					<label for="docker_hostname">Connection Hostname</label>
					<input class="form-control" type="text" name="connection_host" id="docker_hostname"
						placeholder="example.com or 10.0.1.8"
						value="{{ settings.docker_hostname }}">
					<small class="form-text text-muted">
						Hostname displayed to users in connection strings
					</small>
				</div>

				<div class="form-group">
					<label for="container_expiration">Default Container Timeout (minutes)</label>
					<input class="form-control" type="number" name="default_timeout" id="container_expiration"
						placeholder="30" value="{{ settings.container_expiration }}">
					<small class="form-text text-muted">
						How long containers run before auto-termination (0 = never)
					</small>
				</div>

				<div class="form-group">
					<label for="max_renewals">Default Max Renewals</label>
					<input class="form-control" type="number" name="max_renewals" id="max_renewals"
						placeholder="3" value="{{ settings.max_renewals }}">
					<small class="form-text text-muted">
						Maximum number of times users can extend container lifetime
					</small>
				</div>

				<div class="form-group">
					<label for="container_maxmemory">Max Memory per Container</label>
					<input class="form-control" type="text" name="max_memory" id="container_maxmemory"
						placeholder="512m" value="{{ settings.container_maxmemory }}">
					<small class="form-text text-muted">
						e.g., 512m, 1g
					</small>
				</div>

				<div class="form-group">
					<label for="container_maxcpu">Max CPUs per Container</label>
					<input class="form-control" type="text" name="max_cpu" id="container_maxcpu"
						placeholder="1.0" value="{{ settings.container_maxcpu }}">
					<small class="form-text text-muted">
						Float value, e.g., 1.5 means 1.5 cores maximum
					</small>
				</div>
			</div>
		</div>

		<div class="form-group mt-3">
			<button type="submit" class="btn btn-primary">
				<i class="fas fa-save"></i> Save Settings
			</button>
		</div>
	</form>
</div>
{% endblock %}

{% block scripts %}
<script>
document.getElementById('settings-form').addEventListener('submit', function(e) {
	e.preventDefault();
	const formData = new FormData(this);
	const data = Object.fromEntries(formData);
	
	fetch('{{ url_for("containers_admin.api_config_update") }}', {
		method: 'POST',
		headers: {
			'Content-Type': 'application/json',
			'CSRF-Token': '{{ Session.nonce }}'
		},
		body: JSON.stringify(data)
	})
	.then(r => r.json())
	.then(data => {
		if (data.success) {
			alert('Settings saved successfully');
			location.reload();
		} else {
			alert('Error: ' + (data.error || 'Unknown error'));
		}
	})
	.catch(e => alert('Network error: ' + e));
});
</script>
{% endblock %}
